<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ò–≥—Ä–∞ "–ü–æ–π–º–∞–π –ø–æ—Ü–µ–ª—É–π"</title>
  <style>
    :root {
      --primary-color: rgba(255, 0, 0, 0.8);
      --shadow-color: rgba(255, 0, 0, 0.7);
    }

    * {
      touch-action: manipulation;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      user-select: none;
      color: white;
      position: relative;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    #gameContainer {
      width: 90vw;
      height: 90vw;
      max-width: 400px;
      max-height: 400px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 15px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px var(--shadow-color);
      touch-action: none;
    }

    .kiss {
      position: absolute;
      width: 10vw;
      height: 10vw;
      max-width: 40px;
      max-height: 40px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="red"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      cursor: pointer;
      transition: transform 0.1s;
      z-index: 10;
    }

    .trap {
      position: absolute;
      width: 10vw;
      height: 10vw;
      max-width: 40px;
      max-height: 40px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="black"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      z-index: 5;
    }

    .panel {
      position: absolute;
      font-size: 5vw;
      font-weight: bold;
      color: white;
      text-shadow: 0 0 5px black;
      padding: 2vw;
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 2vw;
    }

    #scorePanel {
      top: 2vw;
      left: 2vw;
    }

    #timerPanel {
      top: 2vw;
      right: 2vw;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 100;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 5vw;
    }

    .modal-content {
      background: #222;
      color: white;
      padding: 5vw;
      border-radius: 3vw;
      text-align: center;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 5vw red;
    }

    .modal-title {
      font-size: 6vw;
      margin-bottom: 3vw;
    }

    .modal-text {
      font-size: 5vw;
      margin-bottom: 5vw;
    }

    .modal-button {
      font-size: 4.5vw;
      background-color: red;
      color: white;
      border: none;
      padding: 3vw 6vw;
      border-radius: 2vw;
      cursor: pointer;
      box-shadow: 0 0 2vw red;
      transition: all 0.3s;
      width: 100%;
      margin: 2vw 0;
    }

    .modal-button:hover {
      background-color: darkred;
    }

    @media (min-width: 768px) {
      .panel {
        font-size: 24px;
      }
      
      .modal-title {
        font-size: 28px;
      }
      
      .modal-text {
        font-size: 22px;
      }
      
      .modal-button {
        font-size: 20px;
        padding: 12px 24px;
      }
    }

    #touchArea {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div id="scorePanel" class="panel">–ü–æ—Ü–µ–ª—É–∏: 0</div>
  <div id="timerPanel" class="panel">–í—Ä–µ–º—è: 60</div>
  
  <div id="gameContainer">
    <div id="touchArea"></div>
  </div>
  
  <div id="gameOverModal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞ –∑–∞—é—à—åüòò</h2>
      <p class="modal-text" id="finalScore">–¢—ã –ø–æ–π–º–∞–ª–∞: 0 –ø–æ—Ü–µ–ª—É–µ–≤</p>
      <button id="restartButton" class="modal-button">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
      <button id="nextGameButton" class="modal-button">–°–ª–µ–¥—É—é—â–∞—è –∏–≥—Ä–∞</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const gameContainer = document.getElementById('gameContainer');
      const touchArea = document.getElementById('touchArea');
      const scorePanel = document.getElementById('scorePanel');
      const timerPanel = document.getElementById('timerPanel');
      const gameOverModal = document.getElementById('gameOverModal');
      const finalScore = document.getElementById('finalScore');
      const restartButton = document.getElementById('restartButton');
      const nextGameButton = document.getElementById('nextGameButton');
      
      let score = 0;
      let timeLeft = 60;
      let gameActive = true;
      let traps = [];
      let kisses = [];
      let gameWidth, gameHeight;
      let kissesSinceLastTrap = 0;
      let trapInterval;
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤
      function initSizes() {
        gameWidth = gameContainer.offsetWidth;
        gameHeight = gameContainer.offsetHeight;
      }
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
      function updateScore() {
        scorePanel.textContent = `–ü–æ—Ü–µ–ª—É–∏: ${score}`;
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Ä–¥–µ—á–µ–∫
        kissesSinceLastTrap++;
        
        // –ö–∞–∂–¥—ã–µ 2-3 —Å–µ—Ä–¥–µ—á–∫–∞ —Å–æ–∑–¥–∞–µ–º –ª–æ–≤—É—à–∫—É
        if (kissesSinceLastTrap >= 2 + Math.floor(Math.random() * 2)) {
          createTrap();
          kissesSinceLastTrap = 0;
        }
      }
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
      function updateTimer() {
        timerPanel.textContent = `–í—Ä–µ–º—è: ${timeLeft}`;
      }
      
      // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ü–µ–ª—É—è
      function createKiss() {
        if (!gameActive) return;
        
        const kiss = document.createElement('div');
        kiss.className = 'kiss';
        
        // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
        const x = Math.random() * (gameWidth - kiss.offsetWidth);
        const y = Math.random() * (gameHeight - kiss.offsetHeight);
        
        kiss.style.left = `${x}px`;
        kiss.style.top = `${y}px`;
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
        kiss.style.transform = 'scale(0)';
        kiss.style.transition = 'transform 0.3s, opacity 0.3s';
        
        gameContainer.appendChild(kiss);
        
        setTimeout(() => {
          kiss.style.transform = 'scale(1)';
        }, 10);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
        kiss.addEventListener('click', handleKissClick);
        kiss.addEventListener('touchend', handleKissClick, {passive: true});
        
        kisses.push(kiss);
        
        // –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3-5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
          if (kiss.parentNode) {
            removeElement(kiss);
            kisses = kisses.filter(k => k !== kiss);
          }
        }, 3000 + Math.random() * 2000);
      }
      
      function handleKissClick(e) {
        e.stopPropagation();
        if (!gameActive) return;
        
        const kiss = e.currentTarget;
        score++;
        updateScore();
        
        // –ê–Ω–∏–º–∞—Ü–∏—è
        kiss.style.transform = 'scale(1.5)';
        kiss.style.opacity = '0';
        
        setTimeout(() => {
          removeElement(kiss);
        }, 300);
      }
      
      // –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≤—É—à–∫–∏
      function createTrap() {
        if (!gameActive || traps.length > 3) return; // –ù–µ –±–æ–ª—å—à–µ 3 –ª–æ–≤—É—à–µ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
        
        const trap = document.createElement('div');
        trap.className = 'trap';
        
        // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
        const x = Math.random() * (gameWidth - trap.offsetWidth);
        const y = Math.random() * (gameHeight - trap.offsetHeight);
        
        trap.style.left = `${x}px`;
        trap.style.top = `${y}px`;
        
        gameContainer.appendChild(trap);
        
        // –î–≤–∏–∂–µ–Ω–∏–µ –ª–æ–≤—É—à–∫–∏
        let xSpeed = (Math.random() - 0.5) * 4;
        let ySpeed = (Math.random() - 0.5) * 4;
        
        const moveTrap = () => {
          if (!gameActive) return;
          
          let newX = parseFloat(trap.style.left) + xSpeed;
          let newY = parseFloat(trap.style.top) + ySpeed;
          
          // –û—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω
          if (newX <= 0 || newX >= gameWidth - trap.offsetWidth) {
            xSpeed = -xSpeed;
            newX = parseFloat(trap.style.left) + xSpeed;
          }
          
          if (newY <= 0 || newY >= gameHeight - trap.offsetHeight) {
            ySpeed = -ySpeed;
            newY = parseFloat(trap.style.top) + ySpeed;
          }
          
          trap.style.left = `${newX}px`;
          trap.style.top = `${newY}px`;
          
          if (gameActive) {
            requestAnimationFrame(moveTrap);
          }
        };
        
        moveTrap();
        
        traps.push(trap);
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5-7 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
          if (trap.parentNode) {
            removeElement(trap);
            traps = traps.filter(t => t !== trap);
          }
        }, 5000 + Math.random() * 2000);
      }
      
      // –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞
      function removeElement(el) {
        if (el.parentNode) {
          el.style.transform = 'scale(0)';
          el.style.opacity = '0';
          
          setTimeout(() => {
            if (el.parentNode) {
              el.remove();
            }
          }, 300);
        }
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
      function checkCollisions() {
        let touchX = 0, touchY = 0;
        let isTouching = false;
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π
        touchArea.addEventListener('touchstart', (e) => {
          e.preventDefault();
          const rect = gameContainer.getBoundingClientRect();
          touchX = e.touches[0].clientX - rect.left;
          touchY = e.touches[0].clientY - rect.top;
          isTouching = true;
          checkTrapCollision(touchX, touchY);
        });
        
        touchArea.addEventListener('touchmove', (e) => {
          e.preventDefault();
          const rect = gameContainer.getBoundingClientRect();
          touchX = e.touches[0].clientX - rect.left;
          touchY = e.touches[0].clientY - rect.top;
          checkTrapCollision(touchX, touchY);
        });
        
        touchArea.addEventListener('touchend', () => {
          isTouching = false;
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º—ã—à–∏
        touchArea.addEventListener('mousemove', (e) => {
          if (!isTouching) { // –ß—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–æ —Å —Ç–∞—á–µ–º
            const rect = gameContainer.getBoundingClientRect();
            touchX = e.clientX - rect.left;
            touchY = e.clientY - rect.top;
            checkTrapCollision(touchX, touchY);
          }
        });
      }
      
      function checkTrapCollision(x, y) {
        if (!gameActive) return;
        
        traps.forEach(trap => {
          const trapRect = trap.getBoundingClientRect();
          const containerRect = gameContainer.getBoundingClientRect();
          
          const trapX = trapRect.left - containerRect.left;
          const trapY = trapRect.top - containerRect.top;
          const trapSize = trap.offsetWidth;
          
          if (x > trapX && x < trapX + trapSize &&
              y > trapY && y < trapY + trapSize) {
            endGame();
          }
        });
      }
      
      // –¢–∞–π–º–µ—Ä –∏–≥—Ä—ã
      function startTimer() {
        const timer = setInterval(() => {
          if (!gameActive) {
            clearInterval(timer);
            return;
          }
          
          timeLeft--;
          updateTimer();
          
          if (timeLeft <= 0) {
            endGame();
            clearInterval(timer);
          }
        }, 1000);
      }
      
      // –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
      function endGame() {
        gameActive = false;
        
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        kisses.forEach(kiss => removeElement(kiss));
        traps.forEach(trap => removeElement(trap));
        
        kisses = [];
        traps = [];
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        finalScore.textContent = `–¢—ã –ø–æ–π–º–∞–ª–∞: ${score} –ø–æ—Ü–µ–ª—É–µ–≤)`;
        gameOverModal.style.display = 'flex';
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        localStorage.setItem('kissGameScore', score);
      }
      
      // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
      function startGame() {
        score = 0;
        timeLeft = 60;
        gameActive = true;
        kissesSinceLastTrap = 0;
        
        initSizes();
        updateScore();
        updateTimer();
        gameOverModal.style.display = 'none';
        
        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
        setInterval(createKiss, 800);
        
        checkCollisions();
        startTimer();
      }
      
      // –ö–Ω–æ–ø–∫–∏
      restartButton.addEventListener('click', startGame);
      nextGameButton.addEventListener('click', () => {
        window.location.href = 'next-game.html'; // –°—Å—ã–ª–∫–∞ –Ω–∞ –∏–≥—Ä—É –∑–º–µ–π–∫—É
      });
      
      // –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      startGame();
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
      window.addEventListener('resize', initSizes);
      window.addEventListener('orientationchange', initSizes);
    });
  </script>
</body>
</html>